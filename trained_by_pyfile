import pandas as pd


from sklearn.model_selection import train_test_split
from sklearn.preprocessing import OneHotEncoder, StandardScaler
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import precision_score, recall_score, f1_score,accuracy_score
from sklearn.ensemble import RandomForestClassifier

df=pd.read_csv(r"C:\Users\Suhas\OneDrive\Desktop\PD_MODEL\handwriting_features_labeled.csv")
df=df.drop('person_id',axis=1)


X = df.drop(['parkinsons_label'], axis=1)
y = df['parkinsons_label']

categorical_features = ['task_type']
numerical_features = X.columns.drop(categorical_features)

X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42,stratify=y)


processor=ColumnTransformer(
    transformers=[
        ('cat',OneHotEncoder(handle_unknown='ignore'),categorical_features),
        ('num',StandardScaler(),numerical_features)
    ]
)

model_pipeline_rf=Pipeline(steps=[('processor',processor),
                                  ('classifier',RandomForestClassifier(n_estimators=100,random_state=42))])

model_pipeline_rf.fit(X_train,y_train)

y_pred_rf=model_pipeline_rf.predict(X_test)

accuracy_rf=accuracy_score(y_test,y_pred_rf)
precision_rf=precision_score(y_test,y_pred_rf,zero_division=0)
recall_rf=recall_score(y_test,y_pred_rf,zero_division=0)
f1_score_rf=f1_score(y_test,y_pred_rf,zero_division=0)

print(f"Accuracy of RandomForest: {accuracy_rf:.4f}")
print(f"Precision: {precision_rf:.4f}")
print(f"Recall: {recall_rf:.4f}")
print(f"F1 Score: {f1_score_rf:.4f}")

import joblib

joblib.dump(model_pipeline_rf, 'parkinsons_model.pkl')
print("Model pipeline saved to parkinsons_model.pkl")